<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–µ—Ç–µ–æ-–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –ø–æ–ª—ë—Ç–æ–≤ –ë–í–° | –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</title>
    
    <!-- Plotly.js –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    
    <!-- Leaflet –¥–ª—è –∫–∞—Ä—Ç -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Font Awesome –¥–ª—è –∏–∫–æ–Ω–æ–∫ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #2d3748;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 25px 35px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .header-title h1 {
            color: #2d3748;
            font-size: 32px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-title .subtitle {
            color: #718096;
            font-size: 15px;
        }

        .header-status {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .status-badge {
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-allowed { background: #c6f6d5; color: #22543d; border: 2px solid #38a169; }
        .status-warning { background: #feebc8; color: #744210; border: 2px solid #ed8936; }
        .status-forbidden { background: #fed7d7; color: #742a2a; border: 2px solid #e53e3e; }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 3px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 15px 0;
        }

        .status-item {
            text-align: center;
            padding: 18px;
            border-radius: 10px;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            transition: transform 0.2s;
        }

        .status-item:hover {
            transform: scale(1.05);
        }

        .status-value {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .status-label {
            font-size: 13px;
            color: #718096;
            font-weight: 500;
        }

        .chart-container {
            width: 100%;
            height: 400px;
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
        }

        .flight-windows {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .window {
            padding: 12px 18px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            min-width: 100px;
            text-align: center;
        }

        .window:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .window-allowed {
            background: #c6f6d5;
            color: #22543d;
            border-color: #38a169;
        }

        .window-restricted {
            background: #feebc8;
            color: #744210;
            border-color: #ed8936;
        }

        .window-forbidden {
            background: #fed7d7;
            color: #742a2a;
            border-color: #e53e3e;
        }

        .parameters-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 14px;
        }

        .parameters-table th,
        .parameters-table td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .parameters-table th {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            font-weight: 600;
            color: #4a5568;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.5px;
        }

        .parameters-table tr:hover {
            background: #f7fafc;
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-ok { background: #c6f6d5; color: #22543d; }
        .badge-warning { background: #feebc8; color: #744210; }
        .badge-danger { background: #fed7d7; color: #742a2a; }

        #map {
            height: 450px;
            border-radius: 10px;
            margin-top: 15px;
            z-index: 1;
        }

        .controls {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group label {
            font-weight: 600;
            color: #4a5568;
            font-size: 13px;
            text-transform: uppercase;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }

        input, select {
            padding: 10px 14px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            min-width: 150px;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .alert-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 400px;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease-out;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .alert-warning {
            background: #feebc8;
            color: #744210;
            border-left: 4px solid #ed8936;
        }

        .alert-danger {
            background: #fed7d7;
            color: #742a2a;
            border-left: 4px solid #e53e3e;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: modalSlide 0.3s ease-out;
        }

        @keyframes modalSlide {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .close-modal {
            font-size: 28px;
            cursor: pointer;
            color: #718096;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: #2d3748;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .two-columns {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        @media (max-width: 968px) {
            .two-columns {
                grid-template-columns: 1fr;
            }
            
            .status-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                text-align: center;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #2d3748;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <div class="alert-container" id="alertContainer"></div>

    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <header>
            <div class="header-title">
                <h1><i class="fas fa-helicopter"></i> –ú–µ—Ç–µ–æ-–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –ø–æ–ª—ë—Ç–æ–≤ –ë–í–°</h1>
                <p class="subtitle">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∞ | –î–∏–∞–ø–∞–∑–æ–Ω –≤—ã—Å–æ—Ç: 250‚Äì800 –º | –ê—ç—Ä–æ–¥—Ä–æ–º ¬´–°–µ–≤–µ—Ä–Ω—ã–π¬ª</p>
            </div>
            <div class="header-status">
                <div class="status-badge status-allowed" id="mainStatusBadge">
                    <i class="fas fa-check-circle"></i>
                    <span>–ü–û–õ–Å–¢ –†–ê–ó–†–ï–®–Å–ù</span>
                </div>
                <div style="text-align: right; font-size: 13px; color: #718096;">
                    <div id="currentTime"></div>
                    <div>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="lastUpdate">--:--</span></div>
                </div>
            </div>
        </header>

        <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="controls">
            <div class="form-group">
                <label><i class="fas fa-map-marker-alt"></i> –®–∏—Ä–æ—Ç–∞</label>
                <input type="number" id="lat" placeholder="55.75" value="55.75" step="0.01">
            </div>
            <div class="form-group">
                <label><i class="fas fa-map-marker-alt"></i> –î–æ–ª–≥–æ—Ç–∞</label>
                <input type="number" id="lon" placeholder="37.62" value="37.62" step="0.01">
            </div>
            <div class="form-group">
                <label><i class="fas fa-clock"></i> –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞</label>
                <select id="forecastHours">
                    <option value="24">24 —á–∞—Å–∞</option>
                    <option value="48" selected>48 —á–∞—Å–æ–≤</option>
                    <option value="72">72 —á–∞—Å–∞</option>
                </select>
            </div>
            <button class="btn" onclick="updateData()">
                <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
            </button>
            <button class="btn btn-secondary" onclick="exportReport('json')">
                <i class="fas fa-download"></i> JSON
            </button>
            <button class="btn btn-secondary" onclick="exportReport('csv')">
                <i class="fas fa-file-csv"></i> CSV
            </button>
            <button class="btn btn-warning" onclick="openConfigModal()">
                <i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
            <button class="btn btn-danger" onclick="window.print()">
                <i class="fas fa-print"></i> –ü–µ—á–∞—Ç—å
            </button>
        </div>

        <!-- –°–≤–æ–¥–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ -->
        <div class="dashboard">
            <div class="card">
                <div class="card-title"><i class="fas fa-chart-line"></i> –ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</div>
                <div class="status-grid">
                    <div class="status-item">
                        <div class="status-value" style="color: #4299e1;" id="statWind10m">6.2</div>
                        <div class="status-label">–í–ï–¢–ï–† 10–ú (–º/—Å)</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" style="color: #ed8936;" id="statWind500m">12.1</div>
                        <div class="status-label">–í–ï–¢–ï–† 500–ú (–º/—Å)</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" style="color: #38a169;" id="statVisibility">>5–∫–º</div>
                        <div class="status-label">–í–ò–î–ò–ú–û–°–¢–¨</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" style="color: #9f7aea;" id="statTemp">+5¬∞C</div>
                        <div class="status-label">–¢–ï–ú–ü–ï–†–ê–¢–£–†–ê</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" style="color: #48bb78;" id="statPrecip">0.0</div>
                        <div class="status-label">–û–°–ê–î–ö–ò (–º–º/—á)</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" style="color: #e53e3e;" id="statIcing">–ù–ò–ó–ö–ò–ô</div>
                        <div class="status-label">–û–ë–õ–ï–î–ï–ù–ï–ù–ò–ï</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title"><i class="fas fa-exclamation-triangle"></i> –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
                <table class="parameters-table">
                    <tr>
                        <td><i class="fas fa-wind"></i> –í–µ—Ç–µ—Ä —É –∑–µ–º–ª–∏</td>
                        <td><strong id="paramWind10m">6.2 –º/—Å</strong></td>
                        <td><span class="badge badge-ok" id="badgeWind10m">‚â§10 –º/—Å OK</span></td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-wind"></i> –í–µ—Ç–µ—Ä –Ω–∞ 500–º</td>
                        <td><strong id="paramWind500m">12.1 –º/—Å</strong></td>
                        <td><span class="badge badge-ok" id="badgeWind500m">‚â§15 –º/—Å OK</span></td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-snowflake"></i> –û–±–ª–µ–¥–µ–Ω–µ–Ω–∏–µ</td>
                        <td><strong id="paramIcing">–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫</strong></td>
                        <td><span class="badge badge-ok" id="badgeIcing">OK</span></td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-smog"></i> –¢—É–º–∞–Ω</td>
                        <td><strong id="paramFog">–ù–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ—Ç—Å—è</strong></td>
                        <td><span class="badge badge-ok" id="badgeFog">OK</span></td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-cloud-rain"></i> –û—Å–∞–¥–∫–∏</td>
                        <td><strong id="paramPrecip">0.0 –º–º/—á</strong></td>
                        <td><span class="badge badge-ok" id="badgePrecip">‚â§1.4 OK</span></td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-cloud"></i> –û–±–ª–∞—á–Ω–æ—Å—Ç—å</td>
                        <td><strong id="paramCloud">35%</strong></td>
                        <td><span class="badge badge-ok" id="badgeCloud">OK</span></td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞ –ø–æ–ª—ë—Ç–∞ -->
        <div class="card" style="margin-bottom: 25px;">
            <div class="card-title"><i class="fas fa-calendar-alt"></i> –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è –ø–æ–ª—ë—Ç–∞ (–±–ª–∏–∂–∞–π—à–∏–µ 24 —á–∞—Å–∞)</div>
            <div class="flight-windows" id="flightWindows">
                <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
            </div>
        </div>

        <!-- –ì—Ä–∞—Ñ–∏–∫–∏: –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã -->
        <div class="card full-width" style="margin-bottom: 25px;">
            <div class="card-title"><i class="fas fa-chart-area"></i> –í—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥ –º–µ—Ç–µ–æ–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</div>
            <div id="timeSeriesChart" class="chart-container"></div>
        </div>

        <!-- –ì—Ä–∞—Ñ–∏–∫–∏: –ø—Ä–æ—Ñ–∏–ª–∏ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ -->
        <div class="two-columns" style="margin-bottom: 25px;">
            <div class="card">
                <div class="card-title"><i class="fas fa-layer-group"></i> –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –≤–µ—Ç—Ä–∞</div>
                <div id="verticalProfileChart" class="chart-container"></div>
            </div>
            
            <div class="card">
                <div class="card-title"><i class="fas fa-thermometer-half"></i> –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã</div>
                <div id="temperatureProfileChart" class="chart-container"></div>
            </div>
        </div>

        <div class="two-columns" style="margin-bottom: 25px;">
            <div class="card">
                <div class="card-title"><i class="fas fa-compass"></i> –†–æ–∑–∞ –≤–µ—Ç—Ä–æ–≤</div>
                <div id="windRoseChart" class="chart-container"></div>
            </div>
            
            <div class="card">
                <div class="card-title"><i class="fas fa-wave-square"></i> –ò–Ω–¥–µ–∫—Å —Ç—É—Ä–±—É–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏</div>
                <div id="turbulenceChart" class="chart-container"></div>
            </div>
        </div>

        <div class="two-columns" style="margin-bottom: 25px;">
            <div class="card">
                <div class="card-title"><i class="fas fa-cloud"></i> –í—ã—Å–æ—Ç–∞ –Ω–∏–∂–Ω–µ–π –≥—Ä–∞–Ω–∏—Ü—ã –æ–±–ª–∞–∫–æ–≤</div>
                <div id="ceilingChart" class="chart-container"></div>
            </div>
            
            <div class="card">
                <div class="card-title"><i class="fas fa-calculator"></i> –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ–ª—ë—Ç–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è</div>
                <div id="flightCalculator">
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label>–°–∫–æ—Ä–æ—Å—Ç—å –ë–í–° (–∫–º/—á):</label>
                        <input type="number" id="aircraftSpeed" value="60" min="20" max="150">
                    </div>
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label>–Å–º–∫–æ—Å—Ç—å –±–∞—Ç–∞—Ä–µ–∏ (–º–∏–Ω):</label>
                        <input type="number" id="batteryMinutes" value="90" min="10" max="240">
                    </div>
                    <button class="btn" onclick="calculateFlight()" style="width: 100%;">
                        <i class="fas fa-calculator"></i> –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–ª—ë—Ç–∞
                    </button>
                    <div id="flightPlanResult" style="margin-top: 20px;"></div>
                </div>
            </div>
        </div>

        <!-- –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞ -->
        <div class="card full-width" style="margin-bottom: 25px;">
            <div class="card-title"><i class="fas fa-th"></i> –¢–µ–ø–ª–æ–≤–∞—è –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω–∞—è –∫–∞—Ä—Ç–∞ –ø–æ–ª—ë—Ç–Ω—ã—Ö –æ–∫–æ–Ω</div>
            <div id="heatmapCalendar" class="chart-container"></div>
        </div>

        <!-- –ö–∞—Ä—Ç–∞ -->
        <div class="card full-width" style="margin-bottom: 25px;">
            <div class="card-title"><i class="fas fa-map-marked-alt"></i> –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∏—Å–∫–æ–≤</div>
            <div id="map"></div>
        </div>

        <!-- –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
        <div class="card full-width">
            <div class="card-title"><i class="fas fa-clipboard-list"></i> –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —á–∞—Å–∞–º</div>
            <table class="parameters-table" id="detailedTable">
                <thead>
                    <tr>
                        <th><i class="fas fa-clock"></i> –í—Ä–µ–º—è (UTC)</th>
                        <th><i class="fas fa-info-circle"></i> –°—Ç–∞—Ç—É—Å</th>
                        <th><i class="fas fa-arrows-alt-v"></i> –î–æ–ø—É—Å—Ç–∏–º—ã–µ –≤—ã—Å–æ—Ç—ã</th>
                        <th><i class="fas fa-wind"></i> –í–µ—Ç–µ—Ä 10–º / 500–º</th>
                        <th><i class="fas fa-cloud-rain"></i> –û—Å–∞–¥–∫–∏</th>
                        <th><i class="fas fa-exclamation-circle"></i> –†–∏—Å–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div class="modal" id="configModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π</h2>
                <span class="close-modal" onclick="closeConfigModal()">&times;</span>
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label>–í–µ—Ç–µ—Ä —É –∑–µ–º–ª–∏ (–º/—Å):</label>
                <input type="number" id="thresholdWindGround" value="10" step="0.5">
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label>–í–µ—Ç–µ—Ä –Ω–∞ –≤—ã—Å–æ—Ç–µ (–º/—Å):</label>
                <input type="number" id="thresholdWindAlt" value="15" step="0.5">
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label>–û—Å–∞–¥–∫–∏ (–º–º/—á):</label>
                <input type="number" id="thresholdPrecip" value="1.4" step="0.1">
            </div>
            <div class="form-group" style="margin-bottom: 15px;">
                <label>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å (–∫–º):</label>
                <input type="number" id="thresholdVisibility" value="5" step="0.5">
            </div>
            <div class="form-group" style="margin-bottom: 20px;">
                <label>–†–∞–∑–Ω–∏—Ü–∞ T-Td –¥–ª—è —Ç—É–º–∞–Ω–∞ (¬∞C):</label>
                <input type="number" id="thresholdTempDewpoint" value="2" step="0.5">
            </div>
            <button class="btn" onclick="saveThresholds()" style="width: 100%;">
                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
        </div>
    </div>

    <script>
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let meteorologicalData = [];
        let map = null;
        let alertSystem = null;
        let thresholds = {
            windGround: 10,
            windAlt: 15,
            precip: 1.4,
            visibility: 5,
            tempDewpoint: 2
        };

        // ==================== –ì–ï–ù–ï–†–ê–¶–ò–Ø –î–ï–ú–û-–î–ê–ù–ù–´–• ====================
        function generateDemoData() {
            const data = [];
            const baseTime = new Date('2026-02-19T12:00:00Z');
            const hoursCount = parseInt(document.getElementById('forecastHours').value);
            
            for (let i = 0; i < hoursCount; i++) {
                const time = new Date(baseTime.getTime() + i * 3600000);
                const hour = time.getHours();
                
                // –ò–º–∏—Ç–∞—Ü–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –º–µ—Ç–µ–æ–¥–∞–Ω–Ω—ã—Ö —Å —Å—É—Ç–æ—á–Ω—ã–º —Ü–∏–∫–ª–æ–º
                const wind10m = 5 + 3 * Math.sin((hour - 6) * Math.PI / 12) + Math.random() * 2;
                const wind500m = 10 + 5 * Math.sin((hour - 8) * Math.PI / 12) + Math.random() * 3;
                const windDir = 270 + Math.sin(hour * Math.PI / 12) * 45;
                const temp500m = 5 - 3 * Math.sin((hour - 14) * Math.PI / 12) + Math.random();
                const temp2m = temp500m + 2;
                const rh = 60 + 20 * Math.sin((hour - 10) * Math.PI / 12);
                const precip = (hour > 16 && hour < 19) ? 1.5 + Math.random() : Math.random() * 0.5;
                const cloudCover = 30 + 20 * Math.sin((hour - 10) * Math.PI / 12) + Math.random() * 20;
                const tempDewpointDiff = 3 + Math.random() * 3;
                const visibility = 5 + Math.random() * 5;
                
                // –†–∞—Å—á—ë—Ç —Ç–æ—á–∫–∏ —Ä–æ—Å—ã
                const dewpoint = temp2m - tempDewpointDiff;
                
                // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
                let status = 'allowed';
                let restrictions = [];
                let maxAltitude = 800;
                let icingRisk = 'LOW';
                let fogRisk = 'LOW';
                
                if (wind10m > thresholds.windGround) {
                    restrictions.push(`–í–µ—Ç–µ—Ä —É –∑–µ–º–ª–∏ ${wind10m.toFixed(1)} –º/—Å`);
                    status = status === 'allowed' ? 'restricted' : status;
                }
                
                if (wind500m > thresholds.windAlt) {
                    restrictions.push(`–í–µ—Ç–µ—Ä >${thresholds.windAlt} –º/—Å –Ω–∞ –≤—ã—Å–æ—Ç–µ`);
                    status = 'forbidden';
                    maxAltitude = 400;
                } else if (wind500m > 12) {
                    maxAltitude = 600;
                    if (status === 'allowed') status = 'restricted';
                }
                
                if (precip > thresholds.precip) {
                    restrictions.push(`–û—Å–∞–¥–∫–∏ ${precip.toFixed(1)} –º–º/—á`);
                    status = 'forbidden';
                }
                
                if (tempDewpointDiff < thresholds.tempDewpoint && cloudCover > 80) {
                    restrictions.push('–†–∏—Å–∫ —Ç—É–º–∞–Ω–∞');
                    fogRisk = 'HIGH';
                    if (visibility < thresholds.visibility) {
                        status = 'forbidden';
                    }
                }
                
                // –û—Ü–µ–Ω–∫–∞ –æ–±–ª–µ–¥–µ–Ω–µ–Ω–∏—è
                if (cloudCover > 20 && temp500m <= 5 && temp500m >= -20) {
                    if (temp500m <= 5 && temp500m >= -5) {
                        icingRisk = 'HIGH';
                        restrictions.push('–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –æ–±–ª–µ–¥–µ–Ω–µ–Ω–∏—è');
                        status = 'forbidden';
                    } else {
                        icingRisk = 'MEDIUM';
                        if (status === 'allowed') status = 'restricted';
                    }
                }
                
                data.push({
                    time: time,
                    timeStr: time.toISOString().slice(11, 16),
                    dateStr: time.toISOString().slice(0, 10),
                    wind10m: Math.max(0, wind10m),
                    wind500m: Math.max(0, wind500m),
                    windDir: windDir,
                    temp500m: temp500m,
                    temp2m: temp2m,
                    dewpoint: dewpoint,
                    rh: Math.min(100, Math.max(0, rh)),
                    precip: Math.max(0, precip),
                    cloudCover: Math.min(100, Math.max(0, cloudCover)),
                    tempDewpointDiff: Math.max(0, tempDewpointDiff),
                    visibility: visibility,
                    status: status,
                    restrictions: restrictions,
                    maxAltitude: maxAltitude,
                    icingRisk: icingRisk,
                    fogRisk: fogRisk
                });
            }
            
            return data;
        }

        // ==================== –°–ò–°–¢–ï–ú–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô ====================
        class AlertSystem {
            constructor() {
                this.alerts = [];
                this.checkInterval = null;
            }
            
            checkConditions(data) {
                if (!data || data.length === 0) return;
                
                const current = data[0];
                const newAlerts = [];
                
                if (current.wind10m > thresholds.windGround) {
                    newAlerts.push({ 
                        type: 'warning', 
                        message: `–í–µ—Ç–µ—Ä —É –∑–µ–º–ª–∏ ${current.wind10m.toFixed(1)} –º/—Å –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ø–æ—Ä–æ–≥ ${thresholds.windGround} –º/—Å` 
                    });
                }
                
                if (current.precip > thresholds.precip) {
                    newAlerts.push({ 
                        type: 'danger', 
                        message: `–û—Å–∞–¥–∫–∏ ${current.precip.toFixed(1)} –º–º/—á –ø—Ä–µ–≤—ã—à–∞—é—Ç –ø–æ—Ä–æ–≥ ${thresholds.precip} –º–º/—á` 
                    });
                }
                
                if (current.icingRisk === 'HIGH') {
                    newAlerts.push({ 
                        type: 'danger', 
                        message: '–í–ù–ò–ú–ê–ù–ò–ï: –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –æ–±–ª–µ–¥–µ–Ω–µ–Ω–∏—è!' 
                    });
                }
                
                if (current.fogRisk === 'HIGH') {
                    newAlerts.push({ 
                        type: 'warning', 
                        message: '–í–ù–ò–ú–ê–ù–ò–ï: –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ —Ç—É–º–∞–Ω–∞!' 
                    });
                }
                
                if (JSON.stringify(this.alerts) !== JSON.stringify(newAlerts)) {
                    this.alerts = newAlerts;
                    this.showNotifications();
                }
            }
            
            showNotifications() {
                const container = document.getElementById('alertContainer');
                container.innerHTML = '';
                
                this.alerts.forEach((alert, index) => {
                    setTimeout(() => {
                        const div = document.createElement('div');
                        div.className = `alert alert-${alert.type}`;
                        div.innerHTML = `
                            <i class="fas fa-${alert.type === 'danger' ? 'exclamation-circle' : 'exclamation-triangle'}"></i>
                            <span>${alert.message}</span>
                            <i class="fas fa-times" style="margin-left: auto; cursor: pointer;" onclick="this.parentElement.remove()"></i>
                        `;
                        container.appendChild(div);
                        
                        // –ê–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
                        setTimeout(() => {
                            if (div.parentElement) div.remove();
                        }, 10000);
                    }, index * 200);
                });
                
                // Browser notification
                if (Notification.permission === 'granted' && this.alerts.length > 0) {
                    new Notification('–ú–µ—Ç–µ–æ-–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ë–í–°', {
                        body: this.alerts[0].message,
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üöÅ</text></svg>'
                    });
                }
            }
            
            startMonitoring(data) {
                this.checkConditions(data);
                if (this.checkInterval) clearInterval(this.checkInterval);
                this.checkInterval = setInterval(() => this.checkConditions(data), 60000);
            }
        }

        // ==================== –û–¢–†–ò–°–û–í–ö–ê –ò–ù–¢–ï–†–§–ï–ô–°–ê ====================
        function renderFlightWindows() {
            const container = document.getElementById('flightWindows');
            container.innerHTML = '';
            
            meteorologicalData.slice(0, 24).forEach((hour, index) => {
                const window = document.createElement('div');
                window.className = `window window-${hour.status}`;
                window.innerHTML = `
                    <div><strong>${hour.timeStr}</strong></div>
                    <div style="font-size: 11px; margin-top: 4px;">
                        ${hour.status === 'allowed' ? '‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–æ' : 
                          hour.status === 'restricted' ? '‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è' : '‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ'}
                    </div>
                    ${hour.maxAltitude < 800 ? `<div style="font-size: 10px;">‚â§${hour.maxAltitude}–º</div>` : ''}
                `;
                window.onclick = () => selectHour(index);
                container.appendChild(window);
            });
        }

        function renderTimeSeriesChart() {
            const times = meteorologicalData.map(d => d.time);
            
            const trace1 = {
                x: times,
                y: meteorologicalData.map(d => d.wind500m),
                name: '–í–µ—Ç–µ—Ä 500–º (–º/—Å)',
                type: 'scatter',
                mode: 'lines',
                line: { color: '#4299e1', width: 2 },
                yaxis: 'y1'
            };
            
            const trace2 = {
                x: times,
                y: meteorologicalData.map(d => d.temp500m),
                name: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 500–º (¬∞C)',
                type: 'scatter',
                mode: 'lines',
                line: { color: '#ed8936', width: 2 },
                yaxis: 'y2'
            };
            
            const trace3 = {
                x: times,
                y: meteorologicalData.map(d => d.precip),
                name: '–û—Å–∞–¥–∫–∏ (–º–º/—á)',
                type: 'bar',
                marker: { color: '#63b3ed' },
                yaxis: 'y3'
            };
            
            const trace4 = {
                x: times,
                y: meteorologicalData.map(d => d.tempDewpointDiff),
                name: 'T-Td (¬∞C)',
                type: 'scatter',
                mode: 'lines',
                line: { color: '#48bb78', width: 2 },
                yaxis: 'y4'
            };
            
            const layout = {
                height: 400,
                showlegend: true,
                legend: { x: 0, y: 1, bgcolor: 'rgba(255,255,255,0.8)' },
                grid: { rows: 4, columns: 1, pattern: 'independent' },
                yaxis: { title: '–í–µ—Ç–µ—Ä (–º/—Å)', range: [0, 25] },
                yaxis2: { title: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C)', overlaying: 'y', side: 'right' },
                yaxis3: { title: '–û—Å–∞–¥–∫–∏', overlaying: 'y', side: 'left', anchor: 'free', position: 0.15 },
                yaxis4: { title: 'T-Td', overlaying: 'y', side: 'right', anchor: 'free', position: 0.85 },
                shapes: [
                    { type: 'line', x0: times[0], x1: times[times.length - 1], y0: thresholds.windAlt, y1: thresholds.windAlt,
                      line: { color: 'red', dash: 'dash', width: 2 }, xref: 'x', yref: 'y' },
                    { type: 'line', x0: times[0], x1: times[times.length - 1], y0: thresholds.precip, y1: thresholds.precip,
                      line: { color: 'red', dash: 'dash', width: 2 }, xref: 'x', yref: 'y3' },
                    { type: 'line', x0: times[0], x1: times[times.length - 1], y0: thresholds.tempDewpoint, y1: thresholds.tempDewpoint,
                      line: { color: 'red', dash: 'dash', width: 2 }, xref: 'x', yref: 'y4' },
                    { type: 'rect', x0: times[0], x1: times[times.length - 1], y0: -20, y1: 5,
                      fillcolor: 'lightblue', opacity: 0.15, line: { width: 0 }, xref: 'x', yref: 'y2' }
                ],
                annotations: [
                    { x: times[0], y: thresholds.windAlt, text: `${thresholds.windAlt} –º/—Å`, showarrow: false, xshift: -50, yshift: -10 },
                    { x: times[0], y: thresholds.precip, text: `${thresholds.precip}`, showarrow: false, xshift: -50, yshift: -10 },
                    { x: times[0], y: thresholds.tempDewpoint, text: `${thresholds.tempDewpoint}¬∞C`, showarrow: false, xshift: -50, yshift: -10 },
                    { x: times[0], y: -7.5, text: '–ó–æ–Ω–∞ –æ–±–ª–µ–¥–µ–Ω–µ–Ω–∏—è', showarrow: false, bgcolor: 'lightblue' }
                ],
                margin: { t: 30, b: 40, l: 60, r: 40 }
            };
            
            Plotly.newPlot('timeSeriesChart', [trace1, trace2, trace3, trace4], layout, {responsive: true});
        }

        function renderVerticalProfile() {
            const heights = [250, 300, 400, 500, 600, 700, 800];
            const currentHour = meteorologicalData[2] || meteorologicalData[0];
            
            const windSpeeds = heights.map(h => {
                const baseWind = currentHour.wind10m + (h - 250) * 0.008;
                return baseWind + Math.random() * 1.5;
            });
            
            const colors = windSpeeds.map(ws => ws <= 10 ? '#38a169' : ws <= 15 ? '#d69e2e' : '#e53e3e');
            
            const trace = {
                x: windSpeeds,
                y: heights,
                type: 'bar',
                orientation: 'h',
                marker: { color: colors },
                text: windSpeeds.map(ws => ws.toFixed(1) + ' –º/—Å'),
                textposition: 'auto',
                hoverinfo: 'x+y'
            };
            
            const layout = {
                height: 400,
                xaxis: { title: '–°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞ (–º/—Å)', range: [0, Math.max(20, ...windSpeeds) + 5] },
                yaxis: { title: '–í—ã—Å–æ—Ç–∞ (–º)', range: [200, 850] },
                shapes: [
                    { type: 'line', x0: thresholds.windAlt, x1: thresholds.windAlt, y0: 250, y1: 800,
                      line: { color: 'red', dash: 'dash', width: 2 } }
                ],
                annotations: [
                    { x: thresholds.windAlt + 0.5, y: 800, text: `–ü–æ—Ä–æ–≥ ${thresholds.windAlt} –º/—Å`, 
                      showarrow: false, xref: 'x', yref: 'y' }
                ],
                margin: { t: 30, b: 40, l: 50, r: 30 }
            };
            
            Plotly.newPlot('verticalProfileChart', [trace], layout, {responsive: true});
        }

        function renderTemperatureProfile() {
            const heights = [250, 300, 400, 500, 600, 700, 800];
            const currentHour = meteorologicalData[2] || meteorologicalData[0];
            
            const temps = heights.map(h => currentHour.temp2m - (h - 2) * 0.0065);
            
            const trace = {
                x: temps,
                y: heights,
                mode: 'lines+markers',
                line: { color: '#ed8936', width: 3 },
                marker: { size: 8, color: '#ed8936' },
                hoverinfo: 'x+y'
            };
            
            const layout = {
                height: 400,
                xaxis: { title: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C)', range: [Math.min(...temps) - 2, Math.max(...temps) + 2] },
                yaxis: { title: '–í—ã—Å–æ—Ç–∞ (–º)', range: [200, 850] },
                shapes: [
                    { type: 'rect', x0: -20, x1: 5, y0: 250, y1: 800,
                      fillcolor: 'lightblue', opacity: 0.2, line: { width: 0 }, xref: 'x', yref: 'y' }
                ],
                annotations: [
                    { x: -7.5, y: 820, text: '–ó–æ–Ω–∞ –æ–±–ª–µ–¥–µ–Ω–µ–Ω–∏—è (-20¬∞C –¥–æ +5¬∞C)', 
                      showarrow: false, bgcolor: 'lightblue', xref: 'x', yref: 'y' }
                ],
                margin: { t: 30, b: 40, l: 50, r: 30 }
            };
            
            Plotly.newPlot('temperatureProfileChart', [trace], layout, {responsive: true});
        }

        function renderWindRose() {
            const directions = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
            const dirCounts = new Array(8).fill(0);
            const dirSpeeds = new Array(8).fill(0);
            
            meteorologicalData.forEach(d => {
                const dirIndex = Math.round(((d.windDir % 360) + 360) % 360 / 45) % 8;
                dirCounts[dirIndex]++;
                dirSpeeds[dirIndex] += d.wind500m;
            });
            
            const avgSpeeds = dirSpeeds.map((s, i) => dirCounts[i] ? s / dirCounts[i] : 0);
            
            const trace = {
                type: 'barpolar',
                r: avgSpeeds,
                theta: directions,
                marker: {
                    color: avgSpeeds.map(s => s <= 10 ? '#38a169' : s <= 15 ? '#d69e2e' : '#e53e3e'),
                    line: { color: 'white', width: 1 }
                },
                opacity: 0.8
            };
            
            const layout = {
                height: 400,
                polar: { 
                    radialaxis: { visible: true, range: [0, Math.max(20, ...avgSpeeds) + 5] },
                    angularaxis: { direction: 'clockwise' }
                },
                margin: { t: 30, b: 20, l: 20, r: 20 },
                showlegend: false
            };
            
            Plotly.newPlot('windRoseChart', [trace], layout, {responsive: true});
        }

        function renderTurbulenceChart() {
            const turbulenceData = calculateTurbulenceIndex();
            
            const trace = {
                x: turbulenceData.map(d => d.time),
                y: turbulenceData.map(d => d.index),
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#9f7aea', width: 2 },
                fill: 'tozeroy',
                fillcolor: 'rgba(159, 122, 234, 0.2)'
            };
            
            const layout = {
                height: 400,
                yaxis: { title: '–ò–Ω–¥–µ–∫—Å —Ç—É—Ä–±—É–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (0-10)', range: [0, 10] },
                shapes: [
                    { type: 'rect', x0: turbulenceData[0].time, x1: turbulenceData[turbulenceData.length-1].time,
                      y0: 6, y1: 10, fillcolor: '#fed7d7', opacity: 0.3, line: {width: 0} },
                    { type: 'rect', x0: turbulenceData[0].time, x1: turbulenceData[turbulenceData.length-1].time,
                      y0: 3, y1: 6, fillcolor: '#feebc8', opacity: 0.3, line: {width: 0} }
                ],
                annotations: [
                    { x: turbulenceData[0].time, y: 8, text: '–í—ã—Å–æ–∫–∞—è', showarrow: false, xref: 'x', yref: 'y' },
                    { x: turbulenceData[0].time, y: 4.5, text: '–°—Ä–µ–¥–Ω—è—è', showarrow: false, xref: 'x', yref: 'y' },
                    { x: turbulenceData[0].time, y: 1.5, text: '–ù–∏–∑–∫–∞—è', showarrow: false, xref: 'x', yref: 'y' }
                ],
                margin: { t: 30, b: 40, l: 50, r: 30 }
            };
            
            Plotly.newPlot('turbulenceChart', [trace], layout, {responsive: true});
        }

        function calculateTurbulenceIndex() {
            const heights = [250, 300, 400, 500, 600, 700, 800];
            return meteorologicalData.map((hour, i) => {
                let shear = 0;
                for (let j = 1; j < heights.length; j++) {
                    const ws1 = hour.wind10m + (heights[j-1] - 250) * 0.008;
                    const ws2 = hour.wind10m + (heights[j] - 250) * 0.008;
                    const dh = heights[j] - heights[j-1];
                    shear += Math.abs(ws2 - ws1) / dh * 100;
                }
                return { time: hour.time, index: Math.min(10, shear) };
            });
        }

        function renderCeilingChart() {
            const ceilingData = meteorologicalData.map(d => {
                const ceiling = Math.round(125 * d.tempDewpointDiff);
                return {
                    time: d.time,
                    ceiling: Math.min(ceiling, 1500),
                    status: ceiling < 250 ? 'forbidden' : ceiling < 500 ? 'restricted' : 'allowed'
                };
            });
            
            const colors = ceilingData.map(d => 
                d.status === 'allowed' ? '#38a169' : d.status === 'restricted' ? '#d69e2e' : '#e53e3e'
            );
            
            const trace = {
                x: ceilingData.map(d => d.time),
                y: ceilingData.map(d => d.ceiling),
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#4299e1', width: 2 },
                fill: 'tozeroy',
                fillcolor: 'rgba(66, 153, 225, 0.1)',
                marker: { color: colors, size: 6 }
            };
            
            const layout = {
                height: 400,
                yaxis: { title: '–í—ã—Å–æ—Ç–∞ –æ–±–ª–∞–∫–æ–≤ (–º)', range: [0, 1000] },
                shapes: [
                    { type: 'line', x0: ceilingData[0].time, x1: ceilingData[ceilingData.length-1].time,
                      y0: 250, y1: 250, line: { color: 'red', dash: 'dash', width: 2 } },
                    { type: 'line', x0: ceilingData[0].time, x1: ceilingData[ceilingData.length-1].time,
                      y0: 500, y1: 500, line: { color: 'orange', dash: 'dash', width: 2 } }
                ],
                annotations: [
                    { x: ceilingData[0].time, y: 250, text: '–ú–∏–Ω. 250–º', showarrow: false, yshift: -10 },
                    { x: ceilingData[0].time, y: 500, text: '500–º', showarrow: false, yshift: -10 }
                ],
                margin: { t: 30, b: 40, l: 50, r: 30 }
            };
            
            Plotly.newPlot('ceilingChart', [trace], layout, {responsive: true});
        }

        function renderHeatmapCalendar() {
            const dates = [...new Set(meteorologicalData.map(d => d.dateStr))];
            const hours = Array.from({length: 24}, (_, i) => i.toString().padStart(2, '0') + ':00');
            
            const z = dates.map(date => 
                hours.map(hour => {
                    const record = meteorologicalData.find(d => 
                        d.dateStr === date && d.timeStr.startsWith(hour.slice(0, 2))
                    );
                    return record ? (record.status === 'allowed' ? 1 : record.status === 'restricted' ? 0.5 : 0) : null;
                })
            );
            
            const trace = {
                z: z,
                x: hours,
                y: dates,
                type: 'heatmap',
                colorscale: [[0, '#fed7d7'], [0.5, '#feebc8'], [1, '#c6f6d5']],
                hoverinfo: 'x+y+z',
                hovertemplate: '%{x}<br>%{y}<br>–°—Ç–∞—Ç—É—Å: %{z}<extra></extra>'
            };
            
            const layout = {
                height: 400,
                title: '',
                xaxis: { title: '–ß–∞—Å—ã (UTC)' },
                yaxis: { title: '–î–∞—Ç—ã' },
                margin: { t: 30, b: 40, l: 80, r: 30 }
            };
            
            Plotly.newPlot('heatmapCalendar', [trace], layout, {responsive: true});
        }

        function initMap() {
            if (map) {
                map.remove();
            }
            
            const lat = parseFloat(document.getElementById('lat').value) || 55.75;
            const lon = parseFloat(document.getElementById('lon').value) || 37.62;
            
            map = L.map('map').setView([lat, lon], 10);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 18
            }).addTo(map);
            
            L.marker([lat, lon])
                .addTo(map)
                .bindPopup(`<b>–ê—ç—Ä–æ–¥—Ä–æ–º ¬´–°–µ–≤–µ—Ä–Ω—ã–π¬ª</b><br>–°—Ç–∞—Ç—É—Å: ${getCurrentStatusText()}`)
                .openPopup();
            
            const riskZones = generateRiskZones(lat, lon);
            riskZones.forEach(zone => {
                const color = zone.risk === 'low' ? 'green' : zone.risk === 'medium' ? 'orange' : 'red';
                const opacity = zone.risk === 'low' ? 0.2 : zone.risk === 'medium' ? 0.4 : 0.6;
                
                L.circle([zone.lat, zone.lon], {
                    color: color,
                    fillColor: color,
                    fillOpacity: opacity,
                    radius: zone.radius || 5000,
                    weight: 2
                }).addTo(map).bindPopup(`
                    <b>–ó–æ–Ω–∞ —Ä–∏—Å–∫–∞: ${zone.risk}</b><br>
                    –í–µ—Ç–µ—Ä: ${zone.wind} –º/—Å<br>
                    –í—ã—Å–æ—Ç–∞: ${zone.altitude}–º
                `);
            });
        }

        function generateRiskZones(centerLat, centerLon) {
            const zones = [];
            const current = meteorologicalData[0];
            
            if (!current) return zones;
            
            for (let i = 0; i < 5; i++) {
                const latOffset = (Math.random() - 0.5) * 0.1;
                const lonOffset = (Math.random() - 0.5) * 0.15;
                const wind = current.wind500m + (Math.random() - 0.5) * 5;
                
                let risk = 'low';
                if (wind > thresholds.windAlt) risk = 'high';
                else if (wind > 12) risk = 'medium';
                
                zones.push({
                    lat: centerLat + latOffset,
                    lon: centerLon + lonOffset,
                    risk: risk,
                    wind: wind.toFixed(1),
                    altitude: Math.floor(Math.random() * 600) + 250,
                    radius: Math.random() * 5000 + 3000
                });
            }
            
            return zones;
        }

        function getCurrentStatusText() {
            const current = meteorologicalData[0];
            if (!current) return '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
            return current.status === 'allowed' ? '‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–æ' : 
                   current.status === 'restricted' ? '‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è' : '‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ';
        }

        function renderDetailedTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            meteorologicalData.slice(0, 12).forEach(hour => {
                const row = document.createElement('tr');
                
                const statusBadge = hour.status === 'allowed' ? 
                    '<span class="badge badge-ok">‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–æ</span>' :
                    hour.status === 'restricted' ?
                    '<span class="badge badge-warning">‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è</span>' :
                    '<span class="badge badge-danger">‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ</span>';
                
                const risksText = hour.restrictions.length > 0 ? 
                    hour.restrictions.join(', ') : '–ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π';
                
                row.innerHTML = `
                    <td><strong>${hour.timeStr}</strong></td>
                    <td>${statusBadge}</td>
                    <td>${hour.maxAltitude === 800 ? '250‚Äì800 –º' : `250‚Äì${hour.maxAltitude} –º`}</td>
                    <td>${hour.wind10m.toFixed(1)} / ${hour.wind500m.toFixed(1)} –º/—Å</td>
                    <td>${hour.precip.toFixed(1)} –º–º/—á</td>
                    <td>${risksText}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function updateSummaryStats() {
            if (meteorologicalData.length === 0) return;
            
            const current = meteorologicalData[0];
            
            document.getElementById('statWind10m').textContent = current.wind10m.toFixed(1);
            document.getElementById('statWind500m').textContent = current.wind500m.toFixed(1);
            document.getElementById('statTemp').textContent = `+${current.temp500m.toFixed(1)}¬∞C`;
            document.getElementById('statPrecip').textContent = current.precip.toFixed(1);
            document.getElementById('statVisibility').textContent = `>${current.visibility.toFixed(0)}–∫–º`;
            document.getElementById('statIcing').textContent = current.icingRisk === 'LOW' ? '–ù–ò–ó–ö–ò–ô' : 
                                                                current.icingRisk === 'MEDIUM' ? '–°–†–ï–î–ù–ò–ô' : '–í–´–°–û–ö–ò–ô';
            
            document.getElementById('paramWind10m').textContent = `${current.wind10m.toFixed(1)} –º/—Å`;
            document.getElementById('paramWind500m').textContent = `${current.wind500m.toFixed(1)} –º/—Å`;
            document.getElementById('paramPrecip').textContent = `${current.precip.toFixed(1)} –º–º/—á`;
            document.getElementById('paramCloud').textContent = `${current.cloudCover.toFixed(0)}%`;
            document.getElementById('paramIcing').textContent = current.icingRisk === 'LOW' ? '–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫' : 
                                                                current.icingRisk === 'MEDIUM' ? '–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫' : '–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫';
            document.getElementById('paramFog').textContent = current.fogRisk === 'HIGH' ? '–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫' : '–ù–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ—Ç—Å—è';
            
            updateBadge('badgeWind10m', current.wind10m <= thresholds.windGround);
            updateBadge('badgeWind500m', current.wind500m <= thresholds.windAlt);
            updateBadge('badgePrecip', current.precip <= thresholds.precip);
            updateBadge('badgeIcing', current.icingRisk === 'LOW');
            updateBadge('badgeFog', current.fogRisk !== 'HIGH');
            updateBadge('badgeCloud', current.cloudCover < 80);
            
            const mainBadge = document.getElementById('mainStatusBadge');
            if (current.status === 'allowed') {
                mainBadge.className = 'status-badge status-allowed';
                mainBadge.innerHTML = '<i class="fas fa-check-circle"></i><span>–ü–û–õ–Å–¢ –†–ê–ó–†–ï–®–Å–ù</span>';
            } else if (current.status === 'restricted') {
                mainBadge.className = 'status-badge status-warning';
                mainBadge.innerHTML = '<i class="fas fa-exclamation-triangle"></i><span>–° –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø–ú–ò</span>';
            } else {
                mainBadge.className = 'status-badge status-forbidden';
                mainBadge.innerHTML = '<i class="fas fa-times-circle"></i><span>–ó–ê–ü–†–ï–©–Å–ù</span>';
            }
        }

        function updateBadge(id, isOk) {
            const badge = document.getElementById(id);
            if (isOk) {
                badge.className = 'badge badge-ok';
                badge.textContent = 'OK';
            } else {
                badge.className = 'badge badge-danger';
                badge.textContent = '–ü–†–ï–í–´–®–ï–ù';
            }
        }

        function selectHour(index) {
            const hour = meteorologicalData[index];
            alert(`–í—Ä–µ–º—è: ${hour.timeStr} UTC\n` +
                  `–î–∞—Ç–∞: ${hour.dateStr}\n` +
                  `–°—Ç–∞—Ç—É—Å: ${hour.status === 'allowed' ? '‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–æ' : hour.status === 'restricted' ? '‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è' : '‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ'}\n` +
                  `–ú–∞–∫—Å. –≤—ã—Å–æ—Ç–∞: ${hour.maxAltitude} –º\n` +
                  `–í–µ—Ç–µ—Ä 10–º: ${hour.wind10m.toFixed(1)} –º/—Å\n` +
                  `–í–µ—Ç–µ—Ä 500–º: ${hour.wind500m.toFixed(1)} –º/—Å\n` +
                  `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${hour.temp500m.toFixed(1)}¬∞C\n` +
                  `–û—Å–∞–¥–∫–∏: ${hour.precip.toFixed(1)} –º–º/—á\n` +
                  `–û–±–ª–µ–¥–µ–Ω–µ–Ω–∏–µ: ${hour.icingRisk}\n` +
                  `–¢—É–º–∞–Ω: ${hour.fogRisk}\n` +
                  `–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: ${hour.restrictions.join(', ') || '–ù–µ—Ç'}`);
        }

        // ==================== –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† –ü–û–õ–Å–¢–ê ====================
        function calculateFlight() {
            const aircraftSpeed = parseFloat(document.getElementById('aircraftSpeed').value);
            const batteryMinutes = parseFloat(document.getElementById('batteryMinutes').value);
            const current = meteorologicalData[0];
            
            if (!current) {
                alert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞');
                return;
            }
            
            const windSpeed = current.wind500m;
            const windDir = current.windDir || 270;
            const courseDir = 0;
            
            const windAngle = (windDir - courseDir) * Math.PI / 180;
            const headwind = windSpeed * Math.cos(windAngle);
            const crosswind = windSpeed * Math.sin(windAngle);
            const groundSpeed = Math.max(20, aircraftSpeed - headwind);
            
            const maxDistance = (groundSpeed * batteryMinutes) / 60;
            const reserveDistance = maxDistance * 0.7;
            const safeEndurance = batteryMinutes * 0.7;
            
            const resultDiv = document.getElementById('flightPlanResult');
            resultDiv.innerHTML = `
                <div class="status-grid">
                    <div class="status-item">
                        <div class="status-value" style="color: #4299e1;">${groundSpeed.toFixed(1)}</div>
                        <div class="status-label">–ü–£–¢–ï–í–ê–Ø –°–ö–û–†–û–°–¢–¨ (–∫–º/—á)</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" style="color: #ed8936;">${maxDistance.toFixed(1)}</div>
                        <div class="status-label">–ú–ê–ö–°. –î–ê–õ–¨–ù–û–°–¢–¨ (–∫–º)</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" style="color: #38a169;">${reserveDistance.toFixed(1)}</div>
                        <div class="status-label">–ë–ï–ó–û–ü–ê–°–ù–ê–Ø –î–ê–õ–¨–ù–û–°–¢–¨ (–∫–º)</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" style="color: #9f7aea;">${Math.abs(crosswind).toFixed(1)}</div>
                        <div class="status-label">–ë–û–ö–û–í–û–ô –í–ï–¢–ï–† (–∫–º/—á)</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" style="color: #48bb78;">${safeEndurance.toFixed(0)}</div>
                        <div class="status-label">–ë–ï–ó–û–ü–ê–°–ù–û–ï –í–†–ï–ú–Ø (–º–∏–Ω)</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" style="color: #e53e3e;">${headwind > 0 ? '+' : ''}${headwind.toFixed(1)}</div>
                        <div class="status-label">–í–ï–¢–ï–† –ü–û –ö–£–†–°–£ (–∫–º/—á)</div>
                    </div>
                </div>
                <div style="margin-top: 15px; padding: 10px; background: #f7fafc; border-radius: 6px; font-size: 13px;">
                    <strong><i class="fas fa-info-circle"></i> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong><br>
                    ‚Ä¢ –ó–∞–ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ –ø–æ—Å–∞–¥–∫—É —Å –∑–∞–ø–∞—Å–æ–º 30% –±–∞—Ç–∞—Ä–µ–∏<br>
                    ‚Ä¢ –ü—Ä–∏ –±–æ–∫–æ–≤–æ–º –≤–µ—Ç–µ—Ä–µ >${Math.abs(crosswind).toFixed(0)} –∫–º/—á —Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –∫—É—Ä—Å–∞<br>
                    ‚Ä¢ ${headwind > 0 ? '–í—Å—Ç—Ä–µ—á–Ω—ã–π –≤–µ—Ç–µ—Ä —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –ø–æ–ª—ë—Ç–∞' : '–ü–æ–ø—É—Ç–Ω—ã–π –≤–µ—Ç–µ—Ä —Å–æ–∫—Ä–∞—â–∞–µ—Ç –≤—Ä–µ–º—è –ø–æ–ª—ë—Ç–∞'}
                </div>
            `;
        }

        // ==================== –≠–ö–°–ü–û–†–¢ –î–ê–ù–ù–´–• ====================
        function exportReport(format) {
            if (format === 'json') {
                const report = {
                    generated_at: new Date().toISOString(),
                    location: { 
                        lat: parseFloat(document.getElementById('lat').value), 
                        lon: parseFloat(document.getElementById('lon').value) 
                    },
                    thresholds: thresholds,
                    current_status: meteorologicalData[0] ? meteorologicalData[0].status : 'unknown',
                    flight_windows: meteorologicalData.filter(d => d.status === 'allowed').map(d => ({
                        time: d.timeStr,
                        date: d.dateStr,
                        max_altitude: d.maxAltitude
                    })),
                    parameters: meteorologicalData[0] ? {
                        wind_10m: meteorologicalData[0].wind10m,
                        wind_500m: meteorologicalData[0].wind500m,
                        temperature_500m: meteorologicalData[0].temp500m,
                        precipitation: meteorologicalData[0].precip,
                        cloud_cover: meteorologicalData[0].cloudCover,
                        icing_risk: meteorologicalData[0].icingRisk,
                        fog_risk: meteorologicalData[0].fogRisk
                    } : {},
                    hourly_forecast: meteorologicalData
                };
                
                const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `flight_report_${new Date().toISOString().slice(0,10)}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
            } else if (format === 'csv') {
                const headers = ['Time', 'Date', 'Wind10m', 'Wind500m', 'Temp500m', 'Precip', 'CloudCover', 
                               'Status', 'MaxAltitude', 'IcingRisk', 'FogRisk', 'Restrictions'];
                const rows = meteorologicalData.map(d => [
                    d.timeStr, d.dateStr, d.wind10m.toFixed(1), d.wind500m.toFixed(1),
                    d.temp500m.toFixed(1), d.precip.toFixed(1), d.cloudCover.toFixed(0),
                    d.status, d.maxAltitude, d.icingRisk, d.fogRisk, d.restrictions.join('; ')
                ]);
                
                const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
                const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `meteo_data_${new Date().toISOString().slice(0,10)}.csv`;
                a.click();
                URL.revokeObjectURL(url);
            }
            
            showAlert('success', `–û—Ç—á—ë—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ ${format.toUpperCase()}`);
        }

        // ==================== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ò –ù–ê–°–¢–†–û–ô–ö–ò ====================
        function openConfigModal() {
            document.getElementById('thresholdWindGround').value = thresholds.windGround;
            document.getElementById('thresholdWindAlt').value = thresholds.windAlt;
            document.getElementById('thresholdPrecip').value = thresholds.precip;
            document.getElementById('thresholdVisibility').value = thresholds.visibility;
            document.getElementById('thresholdTempDewpoint').value = thresholds.tempDewpoint;
            document.getElementById('configModal').style.display = 'flex';
        }

        function closeConfigModal() {
            document.getElementById('configModal').style.display = 'none';
        }

        function saveThresholds() {
            thresholds = {
                windGround: parseFloat(document.getElementById('thresholdWindGround').value),
                windAlt: parseFloat(document.getElementById('thresholdWindAlt').value),
                precip: parseFloat(document.getElementById('thresholdPrecip').value),
                visibility: parseFloat(document.getElementById('thresholdVisibility').value),
                tempDewpoint: parseFloat(document.getElementById('thresholdTempDewpoint').value)
            };
            
            localStorage.setItem('uavMeteoThresholds', JSON.stringify(thresholds));
            closeConfigModal();
            
            meteorologicalData = generateDemoData();
            renderAll();
            showAlert('success', '–ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
        }

        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function showAlert(type, message) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type === 'success' ? 'warning' : type}`;
            alert.style.background = type === 'success' ? '#c6f6d5' : '';
            alert.style.color = type === 'success' ? '#22543d' : '';
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i>
                <span>${message}</span>
                <i class="fas fa-times" style="margin-left: auto; cursor: pointer;" onclick="this.parentElement.remove()"></i>
            `;
            container.appendChild(alert);
            setTimeout(() => alert.remove(), 5000);
        }

        function updateData() {
            const btn = event.target;
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<span class="loading"></span> –ó–∞–≥—Ä—É–∑–∫–∞...';
            btn.disabled = true;
            
            setTimeout(() => {
                meteorologicalData = generateDemoData();
                renderAll();
                btn.innerHTML = originalHTML;
                btn.disabled = false;
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'});
                showAlert('success', '–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
            }, 1000);
        }

        function renderAll() {
            renderFlightWindows();
            renderTimeSeriesChart();
            renderVerticalProfile();
            renderTemperatureProfile();
            renderWindRose();
            renderTurbulenceChart();
            renderCeilingChart();
            renderHeatmapCalendar();
            initMap();
            renderDetailedTable();
            updateSummaryStats();
            calculateFlight();
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleString('ru-RU', {
                day: '2-digit', month: '2-digit', year: 'numeric',
                hour: '2-digit', minute: '2-digit', second: '2-digit'
            });
        }

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        window.onload = function() {
            const savedThresholds = localStorage.getItem('uavMeteoThresholds');
            if (savedThresholds) {
                thresholds = JSON.parse(savedThresholds);
            }
            
            meteorologicalData = generateDemoData();
            alertSystem = new AlertSystem();
            alertSystem.startMonitoring(meteorologicalData);
            
            renderAll();
            updateTime();
            setInterval(updateTime, 1000);
            
            if (Notification.permission !== 'granted') {
                Notification.requestPermission();
            }
            
            document.getElementById('configModal').addEventListener('click', function(e) {
                if (e.target === this) closeConfigModal();
            });
        };

        window.onresize = function() {
            Plotly.Plots.resize('timeSeriesChart');
            Plotly.Plots.resize('verticalProfileChart');
            Plotly.Plots.resize('temperatureProfileChart');
            Plotly.Plots.resize('windRoseChart');
            Plotly.Plots.resize('turbulenceChart');
            Plotly.Plots.resize('ceilingChart');
            Plotly.Plots.resize('heatmapCalendar');
        };

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeConfigModal();
        });
    </script>
</body>
</html>