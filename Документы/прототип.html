<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ú–µ—Ç–µ–æ-–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –ë–í–° Pro | SkyArc Style</title>
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
  
  <style>
    :root {
      /* –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ ‚Äî —É—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–π –º–∏–Ω–∏–º–∞–ª–∏–∑–º */
      --bg-map: #eef2f7;
      --bg-panel: #ffffff;
      --bg-panel-hover: #f8f9fa;
      --text-primary: #212529;
      --text-secondary: #6c757d;
      --border-color: #dee2e6;
      --accent: #0d6efd;
      --accent-hover: #0b5ed7;
      --success: #198754;
      --warning: #ffc107;
      --danger: #dc3545;
      --info: #0dcaf0;
      
      /* –¢–µ–Ω–∏ –∏ —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è */
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
      --radius: 6px;
      --radius-lg: 12px;
      
      /* –®—Ä–∏—Ñ—Ç—ã */
      --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      --font-mono: "SF Mono", "Fira Code", "Consolas", monospace;
      
      /* –†–∞–∑–º–µ—Ä—ã –ø–∞–Ω–µ–ª–µ–π */
      --left-menu-width: 280px;
      --right-panel-width: 45vw;
      --header-height: 56px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: var(--font-family);
      font-size: 14px;
      color: var(--text-primary);
      background: var(--bg-map);
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* ========== HEADER ========== */
    .header {
      height: var(--header-height);
      background: var(--bg-panel);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      z-index: 1000;
      box-shadow: var(--shadow-sm);
    }

    .header__logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 600;
      font-size: 16px;
    }

    .header__logo-icon {
      width: 28px;
      height: 28px;
      background: var(--accent);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .header__status {
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 13px;
    }

    .status-badge {
      padding: 4px 10px;
      border-radius: 20px;
      font-weight: 500;
      font-size: 12px;
    }
    .status-vfr { background: #d1e7dd; color: #0f5132; }
    .status-mvfr { background: #fff3cd; color: #664d03; }
    .status-ifr { background: #f8d7da; color: #842029; }

    .header__controls {
      display: flex;
      gap: 8px;
    }

    .btn {
      padding: 6px 14px;
      border: 1px solid var(--border-color);
      background: var(--bg-panel);
      border-radius: var(--radius);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .btn:hover { background: var(--bg-panel-hover); }
    .btn-primary {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    .btn-primary:hover { background: var(--accent-hover); }
    .btn-sm { padding: 4px 10px; font-size: 12px; }

    /* ========== MAIN LAYOUT ========== */
    .main {
      display: flex;
      flex: 1;
      overflow: hidden;
      position: relative;
    }

    /* ========== LEFT MENU ========== */
    .left-menu {
      width: var(--left-menu-width);
      background: var(--bg-panel);
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      padding: 12px;
      gap: 8px;
      z-index: 100;
      overflow-y: auto;
    }

    .menu-section {
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      padding: 12px;
      background: var(--bg-panel);
    }

    .menu-section__title {
      font-weight: 600;
      font-size: 13px;
      margin-bottom: 10px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 10px;
      border-radius: var(--radius);
      cursor: pointer;
      transition: background 0.15s;
      font-size: 13px;
    }
    .menu-item:hover { background: var(--bg-panel-hover); }
    .menu-item.active {
      background: rgba(13, 110, 253, 0.1);
      border-left: 3px solid var(--accent);
      padding-left: 7px;
    }
    .menu-item__icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-panel-hover);
      border-radius: 4px;
      font-size: 12px;
    }

    .phase-indicator {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--accent);
      color: white;
      font-size: 11px;
      font-weight: 600;
    }

    /* ========== MAP CONTAINER ========== */
    .map-container {
      flex: 1;
      position: relative;
      z-index: 1;
    }
    #map {
      width: 100%;
      height: 100%;
      background: var(--bg-map);
    }

    /* Map overlays */
    .map-overlay {
      position: absolute;
      top: 12px;
      left: 12px;
      z-index: 500;
      display: flex;
      flex-direction: column;
      gap: 8px;
      pointer-events: none;
    }
    .map-overlay > * { pointer-events: auto; }

    .map-card {
      background: var(--bg-panel);
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      padding: 10px 12px;
      box-shadow: var(--shadow-md);
      min-width: 220px;
      font-size: 13px;
    }
    .map-card__title {
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 12px;
      color: var(--text-secondary);
    }
    .map-card__row {
      display: flex;
      justify-content: space-between;
      padding: 3px 0;
    }
    .map-card__value {
      font-family: var(--font-mono);
      font-weight: 500;
    }

    .map-legend {
      position: absolute;
      bottom: 20px;
      left: 12px;
      z-index: 500;
      background: var(--bg-panel);
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      padding: 10px;
      box-shadow: var(--shadow-md);
      font-size: 12px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 3px 0;
    }
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 3px;
      border: 1px solid var(--border-color);
    }

    /* Map markers custom styles */
    .custom-marker {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--accent);
      color: white;
      font-weight: 600;
      font-size: 12px;
      border: 2px solid white;
      box-shadow: var(--shadow-md);
      cursor: pointer;
    }
    .marker-wind { background: var(--info); }
    .marker-risk { background: var(--warning); color: #000; }
    .marker-landing { background: var(--success); }

    /* ========== RIGHT PANEL ========== */
    .right-panel {
      width: var(--right-panel-width);
      background: var(--bg-panel);
      border-left: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      z-index: 200;
      transform: translateX(100%);
      transition: transform 0.25s ease;
      box-shadow: var(--shadow-lg);
    }
    .right-panel.open { transform: translateX(0); }

    .right-panel__header {
      padding: 14px 16px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--bg-panel-hover);
    }
    .right-panel__title {
      font-weight: 600;
      font-size: 15px;
    }
    .right-panel__close {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: var(--text-secondary);
      padding: 4px;
      border-radius: 4px;
    }
    .right-panel__close:hover { background: var(--border-color); }

    .right-panel__content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .panel-section {
      border: 1px solid var(--border-color);
      border-radius: var(--radius);
      padding: 14px;
    }
    .panel-section__title {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    /* Tables */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    .data-table th {
      text-align: left;
      padding: 8px 10px;
      background: var(--bg-panel-hover);
      font-weight: 600;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border-color);
    }
    .data-table td {
      padding: 8px 10px;
      border-bottom: 1px solid var(--border-color);
      font-family: var(--font-mono);
    }
    .data-table tr:last-child td { border-bottom: none; }
    .data-table tr:hover { background: var(--bg-panel-hover); }

    /* Charts container */
    .chart-container {
      position: relative;
      height: 200px;
      width: 100%;
    }

    /* Status pills */
    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }
    .status-ok { background: #d1e7dd; color: #0f5132; }
    .status-warn { background: #fff3cd; color: #664d03; }
    .status-err { background: #f8d7da; color: #842029; }

    /* Toggle button for right panel */
    .panel-toggle {
      position: absolute;
      right: calc(var(--right-panel-width) + 8px);
      top: 50%;
      transform: translateY(-50%);
      z-index: 150;
      background: var(--bg-panel);
      border: 1px solid var(--border-color);
      border-radius: 8px 0 0 8px;
      padding: 10px 8px;
      cursor: pointer;
      box-shadow: var(--shadow-md);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: right 0.25s ease;
    }
    .right-panel.open + .panel-toggle {
      right: 8px;
      border-radius: 0 8px 8px 0;
    }
    .panel-toggle:hover { background: var(--bg-panel-hover); }
    .panel-toggle__icon {
      font-size: 18px;
      color: var(--text-secondary);
    }

    /* Responsive */
    @media (max-width: 1200px) {
      :root { --right-panel-width: 90vw; }
      .left-menu { width: 240px; }
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="header">
    <div class="header__logo">
      <div class="header__logo-icon">‚úà</div>
      <span>–ú–µ—Ç–µ–æ-–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –ë–í–° Pro</span>
    </div>
    
    <div class="header__status">
      <span class="status-badge status-vfr">VFR</span>
      <span>ICAO: <strong>UUWW</strong></span>
      <span>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <strong id="update-time">--:--</strong></span>
      <span style="color: var(--text-secondary)">|</span>
      <span>–ì–û–°–¢ –† 58907-2020</span>
    </div>
    
    <div class="header__controls">
      <button class="btn btn-sm" id="btn-refresh">‚ü≥ –û–±–Ω–æ–≤–∏—Ç—å</button>
      <button class="btn btn-sm">üì§ –≠–∫—Å–ø–æ—Ä—Ç</button>
      <button class="btn btn-sm btn-primary" id="btn-certify">‚úì –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</button>
    </div>
  </header>

  <!-- MAIN -->
  <div class="main">
    
    <!-- LEFT MENU -->
    <aside class="left-menu">
      
      <div class="menu-section">
        <div class="menu-section__title">–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ñ–∞–∑–∞–º</div>
        
        <div class="menu-item active" data-phase="phase1">
          <span class="menu-item__icon">1</span>
          <span>–¢–æ—á–∫–∞ –Ω–µ–≤–æ–∑–≤—Ä–∞—Ç–∞</span>
        </div>
        <div class="menu-item" data-phase="phase2">
          <span class="menu-item__icon">2</span>
          <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–ª–æ—Ç–æ–º</span>
        </div>
        <div class="menu-item" data-phase="phase3">
          <span class="menu-item__icon">3</span>
          <span>ML-–∫–∞–ª–∏–±—Ä–æ–≤–∫–∞</span>
        </div>
        <div class="menu-item" data-phase="phase4">
          <span class="menu-item__icon">4</span>
          <span>–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è</span>
        </div>
        <div class="menu-item" data-phase="phase5">
          <span class="phase-indicator">5</span>
          <span>–ú–µ—Ç–µ–æ—Ä–æ–ª–æ–≥–∏—è METAR/TAF</span>
        </div>
      </div>

      <div class="menu-section">
        <div class="menu-section__title">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
        <div class="menu-item">
          <span class="menu-item__icon">üìç</span>
          <span>–ó–æ–Ω—ã –ø–æ—Å–∞–¥–∫–∏</span>
        </div>
        <div class="menu-item">
          <span class="menu-item__icon">üìä</span>
          <span>–ü—Ä–æ–≥–Ω–æ–∑ 72—á</span>
        </div>
        <div class="menu-item">
          <span class="menu-item__icon">‚ö†Ô∏è</span>
          <span>–†–∏—Å–∫–∏ –ø–æ–ª—ë—Ç–∞</span>
        </div>
        <div class="menu-item">
          <span class="menu-item__icon">üóÇÔ∏è</span>
          <span>–ñ—É—Ä–Ω–∞–ª –ø–æ–ª—ë—Ç–æ–≤</span>
        </div>
      </div>

      <div class="menu-section">
        <div class="menu-section__title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞—ç—Ä–æ–¥—Ä–æ–º–∞</div>
        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">
          ICAO: <strong>UUWW</strong><br/>
          –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 55.59¬∞N, 37.26¬∞E<br/>
          –í—ã—Å–æ—Ç–∞: 195 –º
        </div>
        <button class="btn btn-sm" style="width: 100%">–ò–∑–º–µ–Ω–∏—Ç—å –∞—ç—Ä–æ–¥—Ä–æ–º</button>
      </div>

    </aside>

    <!-- MAP -->
    <div class="map-container">
      <div id="map"></div>
      
      <!-- Map overlay cards -->
      <div class="map-overlay">
        <div class="map-card">
          <div class="map-card__title">–¢–µ–∫—É—â–∏–µ —É—Å–ª–æ–≤–∏—è</div>
          <div class="map-card__row">
            <span>–í–µ—Ç–µ—Ä 10–º:</span>
            <span class="map-card__value">6.2 –º/—Å, 240¬∞</span>
          </div>
          <div class="map-card__row">
            <span>–í–µ—Ç–µ—Ä 500–º:</span>
            <span class="map-card__value">12.1 –º/—Å, 250¬∞</span>
          </div>
          <div class="map-card__row">
            <span>–í–∏–¥–∏–º–æ—Å—Ç—å:</span>
            <span class="map-card__value">>10 –∫–º</span>
          </div>
          <div class="map-card__row">
            <span>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</span>
            <span class="map-card__value">+5¬∞C</span>
          </div>
          <div class="map-card__row">
            <span>–û–±–ª–µ–¥–µ–Ω–µ–Ω–∏–µ:</span>
            <span class="status-pill status-ok">–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫</span>
          </div>
        </div>

        <div class="map-card">
          <div class="map-card__title">–¢–æ—á–∫–∞ –Ω–µ–≤–æ–∑–≤—Ä–∞—Ç–∞ (PNR)</div>
          <div class="map-card__row">
            <span>–ú–∞–∫—Å. –¥–∞–ª—å–Ω–æ—Å—Ç—å:</span>
            <span class="map-card__value">24.3 –∫–º</span>
          </div>
          <div class="map-card__row">
            <span>–í—Ä–µ–º—è –¥–æ PNR:</span>
            <span class="map-card__value">18 –º–∏–Ω</span>
          </div>
          <div class="map-card__row">
            <span>–†–µ–∑–µ—Ä–≤ –±–∞—Ç–∞—Ä–µ–∏:</span>
            <span class="map-card__value">32%</span>
          </div>
        </div>
      </div>

      <!-- Map legend -->
      <div class="map-legend">
        <div style="font-weight: 600; margin-bottom: 6px;">–£—Å–ª–æ–≤–Ω—ã–µ –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è</div>
        <div class="legend-item">
          <div class="legend-color" style="background: var(--accent)"></div>
          <span>–ê—ç—Ä–æ–¥—Ä–æ–º / –í–∑–ª—ë—Ç–Ω–∞—è —Ç–æ—á–∫–∞</span>
        </div>
        <div class="legend-item">
          <div class="legend-color marker-wind"></div>
          <span>–ú–µ—Ç–µ–æ—Å—Ç–∞–Ω—Ü–∏—è</span>
        </div>
        <div class="legend-item">
          <div class="legend-color marker-risk"></div>
          <span>–ó–æ–Ω–∞ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–≥–æ —Ä–∏—Å–∫–∞</span>
        </div>
        <div class="legend-item">
          <div class="legend-color marker-landing"></div>
          <span>–ó–æ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø–æ—Å–∞–¥–∫–∏</span>
        </div>
      </div>
    </div>

    <!-- RIGHT PANEL -->
    <aside class="right-panel" id="rightPanel">
      <div class="right-panel__header">
        <div class="right-panel__title" id="panel-title">–ú–µ—Ç–µ–æ—Ä–æ–ª–æ–≥–∏—è: METAR/TAF</div>
        <button class="right-panel__close" id="panel-close">√ó</button>
      </div>
      
      <div class="right-panel__content" id="panel-content">
        <!-- Dynamic content will be injected here -->
      </div>
    </aside>

    <!-- Toggle button -->
    <button class="panel-toggle" id="panel-toggle">
      <span class="panel-toggle__icon">‚óÄ</span>
    </button>

  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <script>
    // ========== STATE & CONFIG ==========
    const state = {
      currentPhase: 'phase5',
      rightPanelOpen: false,
      map: null,
      charts: {},
      aerodrome: { icao: 'UUWW', lat: 55.59, lon: 37.26, elevation: 195 },
      metar: {
        raw: 'UUWW 201200Z 24006MPS 9999 FEW035 05/M02 Q1021 NOSIG',
        wind: { speed: 6.2, direction: 240, gust: null },
        visibility: 10000,
        clouds: { coverage: 'FEW', base: 3500 },
        temp: 5, dewpoint: -2, pressure: 1021
      }
    };

    // ========== MAP INIT ==========
    function initMap() {
      state.map = L.map('map', {
        center: [state.aerodrome.lat, state.aerodrome.lon],
        zoom: 10,
        zoomControl: false,
        attributionControl: true
      });

      // Base layer ‚Äî similar to skyarc.ru style
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors | –î–∞–Ω–Ω—ã–µ: Open-Meteo, –†–æ—Å–≥–∏–¥—Ä–æ–º–µ—Ç',
        maxZoom: 18
      }).addTo(state.map);

      // Zoom controls
      L.control.zoom({ position: 'bottomright' }).addTo(state.map);

      // Aerodrome marker
      const aeroIcon = L.divIcon({
        className: 'custom-marker',
        html: '‚úà',
        iconSize: [28, 28],
        iconAnchor: [14, 14]
      });
      L.marker([state.aerodrome.lat, state.aerodrome.lon], { icon: aeroIcon })
        .addTo(state.map)
        .bindPopup(`<b>${state.aerodrome.icao}</b><br/>–í—ã—Å–æ—Ç–∞: ${state.aerodrome.elevation} –º`);

      // Weather station marker
      const windIcon = L.divIcon({
        className: 'custom-marker marker-wind',
        html: 'üå°Ô∏è',
        iconSize: [28, 28],
        iconAnchor: [14, 14]
      });
      L.marker([state.aerodrome.lat + 0.15, state.aerodrome.lon - 0.2], { icon: windIcon })
        .addTo(state.map)
        .bindPopup('<b>–ú–µ—Ç–µ–æ—Å—Ç–∞–Ω—Ü–∏—è #MSK-07</b><br/>–î–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏');

      // Risk zone polygon (example)
      const riskZone = L.polygon([
        [state.aerodrome.lat + 0.3, state.aerodrome.lon],
        [state.aerodrome.lat + 0.25, state.aerodrome.lon + 0.15],
        [state.aerodrome.lat + 0.1, state.aerodrome.lon + 0.1],
        [state.aerodrome.lat + 0.15, state.aerodrome.lon - 0.1]
      ], {
        color: '#ffc107',
        weight: 2,
        opacity: 0.9,
        fillOpacity: 0.15
      }).addTo(state.map).bindPopup('–ó–æ–Ω–∞ —Ç—É—Ä–±—É–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏ / –ü–æ–≤—ã—à–µ–Ω–Ω—ã–π —Ä–∏—Å–∫');

      // Landing zones
      const landingIcon = L.divIcon({
        className: 'custom-marker marker-landing',
        html: '‚úì',
        iconSize: [28, 28],
        iconAnchor: [14, 14]
      });
      [[0.08, -0.12], [-0.1, 0.05], [0.02, 0.18]].forEach(([dl, dn]) => {
        L.marker([state.aerodrome.lat + dl, state.aerodrome.lon + dn], { icon: landingIcon })
          .addTo(state.map)
          .bindPopup('–ó–æ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø–æ—Å–∞–¥–∫–∏<br/>–†–∞–¥–∏—É—Å: 500 –º');
      });

      // PNR circle
      L.circle([state.aerodrome.lat, state.aerodrome.lon], {
        radius: 24300, // 24.3 km
        color: '#0d6efd',
        weight: 1,
        opacity: 0.6,
        fillOpacity: 0.05,
        dashArray: '5,5'
      }).addTo(state.map).bindPopup('–¢–æ—á–∫–∞ –Ω–µ–≤–æ–∑–≤—Ä–∞—Ç–∞ (PNR)<br/>–ú–∞–∫—Å. –¥–∞–ª—å–Ω–æ—Å—Ç—å: 24.3 –∫–º');
    }

    // ========== RIGHT PANEL CONTENT GENERATORS ==========
    const panelContent = {
      phase1: () => `
        <div class="panel-section">
          <div class="panel-section__title">
            <span>–†–∞—Å—á—ë—Ç —Ç–æ—á–∫–∏ –Ω–µ–≤–æ–∑–≤—Ä–∞—Ç–∞</span>
            <span class="status-pill status-ok">–ê–∫—Ç—É–∞–ª—å–Ω–æ</span>
          </div>
          <table class="data-table">
            <tr><td>–°–∫–æ—Ä–æ—Å—Ç—å –ë–í–°</td><td>15.2 –º/—Å</td></tr>
            <tr><td>–†–∞—Å—Ö–æ–¥ –±–∞—Ç–∞—Ä–µ–∏</td><td>1.8%/–º–∏–Ω</td></tr>
            <tr><td>–í—Å—Ç—Ä–µ—á–Ω—ã–π –≤–µ—Ç–µ—Ä</td><td>6.2 –º/—Å</td></tr>
            <tr><td><strong>–ú–∞–∫—Å. –¥–∞–ª—å–Ω–æ—Å—Ç—å</strong></td><td><strong>24.3 –∫–º</strong></td></tr>
            <tr><td><strong>–í—Ä–µ–º—è –¥–æ PNR</strong></td><td><strong>18 –º–∏–Ω</strong></td></tr>
            <tr><td>–†–µ–∑–µ—Ä–≤ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞</td><td>32%</td></tr>
          </table>
        </div>
        <div class="panel-section">
          <div class="panel-section__title">–ó–æ–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø–æ—Å–∞–¥–∫–∏ (—Ä–∞–¥–∏—É—Å 50 –∫–º)</div>
          <div class="chart-container">
            <canvas id="chart-zones"></canvas>
          </div>
        </div>
      `,
      phase2: () => `
        <div class="panel-section">
          <div class="panel-section__title">–°—Ç–∞—Ç—É—Å —Ñ–ª–æ—Ç–∞ –ë–í–°</div>
          <table class="data-table">
            <thead><tr><th>ID</th><th>–ú–æ–¥–µ–ª—å</th><th>–°—Ç–∞—Ç—É—Å</th><th>–ë–∞—Ç–∞—Ä–µ—è</th></tr></thead>
            <tbody>
              <tr><td>BVS-001</td><td>DJI M300</td><td><span class="status-pill status-ok">–ì–æ—Ç–æ–≤</span></td><td>94%</td></tr>
              <tr><td>BVS-007</td><td>Autel EVO II</td><td><span class="status-pill status-warn">–í –ø–æ–ª—ë—Ç–µ</span></td><td>67%</td></tr>
              <tr><td>BVS-012</td><td>Custom VTOL</td><td><span class="status-pill status-err">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</span></td><td>--</td></tr>
            </tbody>
          </table>
        </div>
        <div class="panel-section">
          <div class="panel-section__title">–ê–Ω—Å–∞–º–±–ª–µ–≤—ã–π –ø—Ä–æ–≥–Ω–æ–∑ –≤–µ—Ç—Ä–∞</div>
          <div class="chart-container">
            <canvas id="chart-wind-ensemble"></canvas>
          </div>
        </div>
      `,
      phase3: () => `
        <div class="panel-section">
          <div class="panel-section__title">ML-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏</div>
          <table class="data-table">
            <tr><td>–û–±—É—á–∞—é—â–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤</td><td>87 / 100</td></tr>
            <tr><td>–¢–æ—á–Ω–æ—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑–∞</td><td>94.2%</td></tr>
            <tr><td>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏</td><td>1.07</td></tr>
            <tr><td>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±—É—á–µ–Ω–∏–µ</td><td>2026-02-18</td></tr>
          </table>
          <div style="margin-top: 12px; display: flex; gap: 8px;">
            <button class="btn btn-sm btn-primary">–û–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å</button>
            <button class="btn btn-sm">–°–±—Ä–æ—Å–∏—Ç—å</button>
          </div>
        </div>
        <div class="panel-section">
          <div class="panel-section__title">–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö</div>
          <div style="background: var(--bg-panel-hover); border-radius: 4px; height: 8px; margin: 8px 0;">
            <div style="width: 87%; background: var(--accent); height: 100%; border-radius: 4px;"></div>
          </div>
          <div style="font-size: 12px; color: var(--text-secondary); text-align: right;">87% —Ü–µ–ª–∏</div>
        </div>
      `,
      phase4: () => `
        <div class="panel-section">
          <div class="panel-section__title">–ß–µ–∫-–ª–∏—Å—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</div>
          <table class="data-table">
            <tr><td>‚úì METAR –ø–æ–ª—É—á–µ–Ω</td><td><span class="status-pill status-ok">OK</span></td></tr>
            <tr><td>‚úì TAF —Å–≤–µ—Ä–µ–Ω</td><td><span class="status-pill status-ok">OK</span></td></tr>
            <tr><td>‚úì –†–∏—Å–∫–∏ –æ—Ü–µ–Ω–µ–Ω—ã</td><td><span class="status-pill status-ok">OK</span></td></tr>
            <tr><td>‚úì PNR —Ä–∞—Å—Å—á–∏—Ç–∞–Ω</td><td><span class="status-pill status-ok">OK</span></td></tr>
            <tr><td>‚è≥ –ü–æ–¥–ø–∏—Å—å –ø–∏–ª–æ—Ç–∞</td><td><span class="status-pill status-warn">–û–∂–∏–¥–∞–µ—Ç</span></td></tr>
          </table>
        </div>
        <div class="panel-section">
          <div class="panel-section__title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞—É–¥–∏—Ç–∞</div>
          <select class="btn btn-sm" style="width: 100%; margin-bottom: 10px;">
            <option>–ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</option>
            <option>–ö–æ–º–ø–ª–∞–µ–Ω—Å-–ø—Ä–æ–≤–µ—Ä–∫–∞</option>
            <option>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞—É–¥–∏—Ç</option>
          </select>
          <button class="btn btn-sm btn-primary" style="width: 100%">–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞—É–¥–∏—Ç</button>
        </div>
      `,
      phase5: () => `
        <div class="panel-section">
          <div class="panel-section__title">
            <span>–ò—Å—Ö–æ–¥–Ω—ã–π METAR</span>
            <div style="display: flex; gap: 6px;">
              <button class="btn btn-sm" id="btn-metar-refresh">‚ü≥</button>
              <button class="btn btn-sm">üìã</button>
            </div>
          </div>
          <div style="background: var(--bg-panel-hover); padding: 10px; border-radius: 4px; font-family: var(--font-mono); font-size: 13px; margin-bottom: 12px;">
            ${state.metar.raw}
          </div>
          <table class="data-table">
            <tr><td>–í–µ—Ç–µ—Ä</td><td>240¬∞ / 6.2 –º/—Å</td></tr>
            <tr><td>–í–∏–¥–∏–º–æ—Å—Ç—å</td><td>>10 –∫–º</td></tr>
            <tr><td>–û–±–ª–∞—á–Ω–æ—Å—Ç—å</td><td>FEW035 (3500 ft)</td></tr>
            <tr><td>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ / –¢–æ—á–∫–∞ —Ä–æ—Å—ã</td><td>+5¬∞C / -2¬∞C</td></tr>
            <tr><td>–î–∞–≤–ª–µ–Ω–∏–µ (QNH)</td><td>1021 –≥–ü–∞</td></tr>
          </table>
        </div>
        
        <div class="panel-section">
          <div class="panel-section__title">–õ—ë—Ç–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</div>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; text-align: center; margin-bottom: 12px;">
            <div style="padding: 8px; background: #d1e7dd; border-radius: 4px; font-weight: 600;">VFR</div>
            <div style="padding: 8px; background: var(--bg-panel-hover); border-radius: 4px; color: var(--text-secondary);">MVFR</div>
            <div style="padding: 8px; background: var(--bg-panel-hover); border-radius: 4px; color: var(--text-secondary);">IFR</div>
          </div>
          <div style="font-size: 12px; color: var(--text-secondary);">
            VFR: –í–∏–¥–∏–º–æ—Å—Ç—å ‚â• 10 –∫–º, –ü–æ—Ç–æ–ª–æ–∫ ‚â• 3000 ft
          </div>
        </div>

        <div class="panel-section">
          <div class="panel-section__title">METAR vs Open-Meteo</div>
          <table class="data-table">
            <thead><tr><th>–ü–∞—Ä–∞–º–µ—Ç—Ä</th><th>METAR</th><th>Open-Meteo</th><th>Œî</th></tr></thead>
            <tbody>
              <tr><td>–í–µ—Ç–µ—Ä (–º/—Å)</td><td>6.2</td><td>5.8</td><td>+0.4</td></tr>
              <tr><td>–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</td><td>240¬∞</td><td>235¬∞</td><td>+5¬∞</td></tr>
              <tr><td>–í–∏–¥–∏–º–æ—Å—Ç—å</td><td>>10 –∫–º</td><td>12 –∫–º</td><td>‚Äî</td></tr>
              <tr><td>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</td><td>+5¬∞C</td><td>+4.7¬∞C</td><td>+0.3¬∞C</td></tr>
            </tbody>
          </table>
        </div>

        <div class="panel-section">
          <div class="panel-section__title">–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 24 —á–∞—Å–∞</div>
          <div class="chart-container">
            <canvas id="chart-forecast"></canvas>
          </div>
        </div>
      `
    };

    // ========== CHART RENDERERS ==========
    function renderCharts(phase) {
      // Destroy existing charts
      Object.values(state.charts).forEach(chart => chart?.destroy());
      state.charts = {};

      if (phase === 'phase1') {
        const ctx = document.getElementById('chart-zones');
        if (ctx) {
          state.charts.zones = new Chart(ctx, {
            type: 'radar',
             {
              labels: ['–°-–í', '–í', '–Æ-–í', '–Æ', '–Æ-–ó', '–ó', '–°-–ó', '–°'],
              datasets: [{
                label: '–ü—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç—å –∑–æ–Ω',
                data: [85, 92, 78, 95, 88, 70, 82, 90],
                borderColor: '#198754',
                backgroundColor: 'rgba(25, 135, 84, 0.1)',
                pointBackgroundColor: '#198754'
              }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { r: { min: 0, max: 100 } } }
          });
        }
      }
      
      if (phase === 'phase2') {
        const ctx = document.getElementById('chart-wind-ensemble');
        if (ctx) {
          state.charts.ensemble = new Chart(ctx, {
            type: 'line',
             {
              labels: ['00', '03', '06', '09', '12', '15', '18', '21'],
              datasets: [
                { label: '–°—Ä–µ–¥–Ω–µ–µ', data: [5.2, 6.1, 7.3, 6.8, 6.2, 5.9, 6.5, 5.8], borderColor: '#0d6efd', tension: 0.3, fill: false },
                { label: '¬±1œÉ', data: [4.1, 5.0, 6.2, 5.7, 5.1, 4.8, 5.4, 4.7], borderColor: 'rgba(13,110,253,0.3)', borderDash: [5,5], pointRadius: 0, fill: false },
                { label: '–ú–∞–∫—Å',  [7.8, 8.9, 10.1, 9.2, 8.5, 8.0, 9.1, 8.2], borderColor: '#dc3545', tension: 0.3, pointRadius: 0, fill: false }
              ]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } }, scales: { y: { title: { display: true, text: '–º/—Å' } } } }
          });
        }
      }
      
      if (phase === 'phase5') {
        const ctx = document.getElementById('chart-forecast');
        if (ctx) {
          state.charts.forecast = new Chart(ctx, {
            type: 'bar',
             {
              labels: ['12', '15', '18', '21', '00', '03', '06', '09'],
              datasets: [
                { 
                  label: '–í–µ—Ç–µ—Ä (–º/—Å)', 
                   [6.2, 6.8, 7.1, 6.5, 5.9, 5.2, 4.8, 5.5], 
                  backgroundColor: 'rgba(13, 110, 253, 0.6)',
                  yAxisID: 'y'
                },
                { 
                  label: '–û—Å–∞–¥–∫–∏ (–º–º/—á)', 
                   [0, 0, 0.2, 0.8, 1.2, 0.5, 0, 0], 
                  backgroundColor: 'rgba(25, 135, 84, 0.6)',
                  yAxisID: 'y1'
                }
              ]
            },
            options: {
              responsive: true, maintainAspectRatio: false,
              plugins: { legend: { position: 'bottom' } },
              scales: {
                y: { type: 'linear', display: true, position: 'left', title: { display: true, text: '–í–µ—Ç–µ—Ä, –º/—Å' }, grid: { drawOnChartArea: false } },
                y1: { type: 'linear', display: true, position: 'right', title: { display: true, text: '–û—Å–∞–¥–∫–∏, –º–º/—á' }, grid: { drawOnChartArea: false } }
              }
            }
          });
        }
      }
    }

    // ========== PANEL CONTROL ==========
    function openPanel(phase) {
      const panel = document.getElementById('rightPanel');
      const toggle = document.getElementById('panel-toggle');
      const title = document.getElementById('panel-title');
      const content = document.getElementById('panel-content');
      
      // Update title
      const titles = {
        phase1: '–§–ê–ó–ê 1: –¢–æ—á–∫–∞ –Ω–µ–≤–æ–∑–≤—Ä–∞—Ç–∞',
        phase2: '–§–ê–ó–ê 2: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–ª–æ—Ç–æ–º',
        phase3: '–§–ê–ó–ê 3: ML-–∫–∞–ª–∏–±—Ä–æ–≤–∫–∞',
        phase4: '–§–ê–ó–ê 4: –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è',
        phase5: '–§–ê–ó–ê 5: –ú–µ—Ç–µ–æ—Ä–æ–ª–æ–≥–∏—è METAR/TAF'
      };
      title.textContent = titles[phase] || '–ê–Ω–∞–ª–∏—Ç–∏–∫–∞';
      
      // Inject content
      content.innerHTML = panelContent[phase]?.() || panelContent.phase5();
      
      // Open panel
      panel.classList.add('open');
      toggle.querySelector('.panel-toggle__icon').textContent = '‚ñ∂';
      state.rightPanelOpen = true;
      
      // Render charts after DOM update
      setTimeout(() => renderCharts(phase), 100);
    }

    function closePanel() {
      const panel = document.getElementById('rightPanel');
      const toggle = document.getElementById('panel-toggle');
      panel.classList.remove('open');
      toggle.querySelector('.panel-toggle__icon').textContent = '‚óÄ';
      state.rightPanelOpen = false;
    }

    // ========== EVENT LISTENERS ==========
    function initEvents() {
      // Menu items
      document.querySelectorAll('.menu-item').forEach(item => {
        item.addEventListener('click', () => {
          document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
          item.classList.add('active');
          const phase = item.dataset.phase;
          if (phase) {
            state.currentPhase = phase;
            openPanel(phase);
          }
        });
      });

      // Panel toggle
      document.getElementById('panel-toggle').addEventListener('click', () => {
        if (state.rightPanelOpen) closePanel();
        else openPanel(state.currentPhase);
      });
      document.getElementById('panel-close').addEventListener('click', closePanel);

      // Header buttons
      document.getElementById('btn-refresh').addEventListener('click', () => {
        document.getElementById('update-time').textContent = new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
        // Simulate data refresh
        alert('–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
      });
      document.getElementById('btn-certify').addEventListener('click', () => {
        alert('–ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
      });

      // METAR refresh in panel
      document.addEventListener('click', (e) => {
        if (e.target.id === 'btn-metar-refresh') {
          alert('METAR –æ–±–Ω–æ–≤–ª—ë–Ω');
        }
      });

      // Update time on load
      document.getElementById('update-time').textContent = new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
    }

    // ========== INIT ==========
    document.addEventListener('DOMContentLoaded', () => {
      initMap();
      initEvents();
      // Open phase 5 by default
      openPanel('phase5');
    });
  </script>
</body>
</html>